# -*- coding: utf-8 -*-
"""generate_manga_dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1HE-vpbqh8EEgioejw0P1CBIn5JjJ_SAF
"""

import os
import cv2
import numpy as np

# Klasör yollarını belirle
annotation_folder = '/content/manga_landmarks_yolo'
output_folder = '/content/manga_landmarks_formatted'

# Klasör oluştur (varsa mevcut olanı kullan)
os.makedirs(output_folder, exist_ok=True)

# Tüm .txt dosyalarını oku
for annotation_file in os.listdir(annotation_folder):
    if annotation_file.endswith('.txt'):
        annotation_path = os.path.join(annotation_folder, annotation_file)
        output_path = os.path.join(output_folder, annotation_file)

        # Anotasyon verilerini oku
        data = []
        with open(annotation_path, 'r') as file:
            for line in file:
              # Satırı boşluk veya yeni satır karakterlerinden kurtul
              line = line.strip()
              # Satırı boşluk karakterlerine göre ayır ve sadece keypoint verilerini al
              values = line.split()[5:]
              # Keypoint verilerini float'a dönüştür
              keypoints = [float(val) for i, val in enumerate(values) if (i+1) % 3 != 0]
              data.extend(keypoints)

        # Verileri numpy array'e çevir ve 17x2 boyutunda yeniden şekillendir
        data = np.array(data).reshape((17, 2))

        # Normalleştirilmiş koordinatları piksel değerlerine çevir
        pixel_data = []
        for x, y in data:
            pixel_data.append((x, y))

        # Piksel verilerini dosyaya yaz
        with open(output_path, 'w') as file:
            for x, y in pixel_data:
                file.write(f"{x}\n{y}\n")

        print(f"Pixel data written to {output_path}")

!zip -r manga_landmarks.zip /content/manga_landmarks_formatted/